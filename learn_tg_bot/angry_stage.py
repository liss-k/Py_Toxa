import random
from telegram import KeyboardButton, ReplyKeyboardMarkup, ReplyKeyboardRemove
# -*- coding: UTF-8 -*-

def angryStage(bot,update):
    text=update.message.text
    chat_id=update.message.chat.id
    if text=='–ë—ã–≤–∞–µ—Ç, –ø—Ä–æ—Å—Ç–æ –º–æ–ª—á–∏—à—å, –∞ —Ç–µ–±—è —É–∂–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª–∏((':
        return 'angry_stage'

    global ANGRY_STAGE_DIC
    try:
        ANGRY_STAGE_DIC[chat_id]['msg_counter']+=1
    except (KeyError, NameError, UnboundLocalError):
        ANGRY_STAGE_DIC={chat_id:{'msg_counter':0, 'score':0, 'used_list':[], 'know_rules':False}}

    good_gift_dic={('üéÅ'):'–¢–≤–æ–∏ –ø–æ–¥–∞—Ä–∫–∏ –¥–µ–ª–∞—é—Ç –º–µ–Ω—è —Å—á–∞—Å—Ç–ª–∏–≤–æ–π! –ê –Ω–∞ –ø—Ä—ã–≥–∞—é—â—É—é –æ—Ç —Å—á–∞—Å—Ç—å—è –∂–µ–Ω—â–∏–Ω—É –º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ...)',
                ('üíç','üíé'):'–ú–æ—â–Ω–æ! –ò –¥–∞–∂–µ –¥—Ä–∞–º–∞—Ç–∏—á–Ω–æ!) –°–ø–∞—Å–∏–±–æ, –º–∏–ª—ã–π!üíñ',
                ('üëö','üëó','üëô','üë†','üë°','üë¢','üëí','üéí','üëù','üëõ','üëú'):'–ò –∫–∞–∫ —Ç—ã —Ç–æ–ª—å–∫–æ —É–º—É–¥—Ä—è–µ—à—å—Å—è —É–≥–∞–¥—ã–≤–∞—Ç—å, —á–µ–≥–æ —è —Ö–æ—á—É?)',
                ('üëë'):'–ê–∞–∞–∞–∞, —Å —É–º–∞ —Å–æ–π—Ç–∏!!! –≠—Ç–æ –ø—Ä–∏—è—Ç–Ω–µ–µ, —á–µ–º 10 —Ñ–∏–ª—å–º–æ–≤ —Å–æ —Å—á–∞—Å—Ç–ª–∏–≤—ã–º –∫–æ–Ω—Ü–æ–º!',
                ('üï∫'):'–¢—ã –ø–æ–¥–∞—Ä–∏–ª –º–Ω–µ —Ç–∞–Ω–µ—Ü))) –û–≥–æ–Ω—å!',
                ('üåé','üåç','üåè'):'–¢—ã –≥–æ—Ç–æ–≤ –±—Ä–æ—Å–∏—Ç—å –∫ –º–æ–∏–º –Ω–æ–≥–∞–º –≤–µ—Å—å –º–∏—Ä? –ú–æ–π —Ä—ã—Ü–∞—Ä—å!',
                ('üåû','üí´','‚≠êÔ∏è','üåü','‚ú®','‚òÄÔ∏è'):'–ó–≤–µ–∑–¥–∞ —Å –Ω–µ–±–∞...–≠—Ç–æ —Ç–∞–∫ –ø—Ä–∏—Ç—è–≥–∞—Ç–µ–ª—å–Ω–æ...–µ—Å–ª–∏ —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å –∫–∞–ª–∞–º–±—É—Ä—ã –ø—Ä–æ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é))'
                }
    bad_gift_dic={('ü•Ä'):'–ö–≤—ë–ª–∞—è —Ä–æ–∑–∞ —á—ë—Ç –Ω–µ –≤–æ–∑–±—É–∂–¥–∞–µ—Ç',
                ('üí©'):'–ö–∞–∫—É–ª—è??? –¢—ã –ø–æ–¥–∞—Ä–∏–ª –º–Ω–µ –∫–∞–∫—É–ª—é???!! –û—á–µ–≤–∏–¥–Ω–æ–µ, –Ω–æ –±–µ—Å–ø–æ–ª–µ–∑–æ–µ —Ä–µ—à–µ–Ω–∏–µ',
                ('‚òî','üåÇ','‚òÇ'):'–í–∞–∞–∞–∞-–∞-–∞–∂–Ω–µ–µ–µ-–µ–π –≤—Å–µ–≥–æ–æ–æ–æ, –ø–æ–≥–æ–æ–æ–æ–¥–∞ –≤ –¥–æ-–æ-–æ–º–µ...–ù—É —Ç–∞–∫–æ–µ',
                ('üçÜ'):'üçÜüí¶',
                ('ü•Ñ','üç¥','üçΩ','ü•£','ü•°','ü•¢'):'–ê –µ–¥—ã? –ï–¥—ã –¥–∞–¥—É—Ç?',
                ('ü•õ','üçº','ü•§'):'–≠—Ç–æ –Ω–∞—Å –Ω–∏ –∫ —á–µ–º—É –Ω–µ –ø—Ä–∏–≤–µ–¥–µ—Ç...',
                ('üåï','üåñ','üåó','üåò','üåë','üåí','üåì','üåî','üåö','üåù','üåõ','üåú','üåô'):'–í–æ –∏–º—è –ª—É–Ω—ã! –ù–æ –Ω–µ—Ç...—ç—Ç–æ –Ω–µ —Ç–æ...',
                ('‚ù§Ô∏è','‚ù§','üíö','üíõ','üíô','üíú','üñ§','üíò','üíñ','üíó','üíì','üíû','üíï','‚ù£Ô∏è','üíù','üíü','üòò'):'–û–≥–æ, —Å–ª–æ–≤–∞ –ª—é–±–≤–∏...—Å –∫–æ–∑—ã—Ä–µ–π –ø–æ—à–µ–ª?) –ù–æ —è, –∑–Ω–∞–µ—à—å –ª–∏, –º–∞—Ç–µ—Ä–∏–∞–ª–∏—Å—Ç–∫–∞',
                ('üíê','üå∑','üåπ','üåª','üåº','üå∏','üå∫'):'–§–∞–∫, –µ–µ–µ–∞–∞—Ö—Ö! –ù–æ, –º–æ–∂–µ—Ç, —á—Ç–æ-—Ç–æ —á—É—Ç–æ—á–∫—É –º–µ–Ω–µ–µ –±–∞–Ω–∞–ª—å–Ω–æ–µ?',
                ('üç∂','üç∫','üçª','ü•Ç','üç∑','ü•É','üç∏','üçπ','üçæ'):'–¢—ã –ª—É—á—à–∏–π, –ø—Ä–∞–≤–¥–∞! –ù–æ —Å–µ–≥–æ–¥–Ω—è –ø–∏—Ç—å —è —É–∂–µ –±–æ–ª—å—à–µ –Ω–µ –º–æ–≥—É((( –°–∞–º–∞ –Ω–µ —Ä–∞–¥–∞((',
                ('üçè','üçé','üçê','üçä','üçã','üçå','üçâ','üçá','üçì','üçà','üçë','üçí','ü•†','ü•ß',
                'üçç','ü•ù','ü•ë','üçÖ','ü•í','ü•ï','üåΩ','üå∂','ü•î','üç†','üå∞','ü••','ü•¶','ü•®',
                'üç≥','ü•ö','üßÄ','ü•ñ','üçû','ü•ê','üçØ','ü•ú','ü•ì','ü•û','üç§','üçó','ü•©','ü•™','ü•´',
                'üçñ','üçï','üå≠','üçî','üçú','üçù','ü•ò','ü•ó','üåØ','üåÆ','ü•ô','üçü','ü•ü',
                'üç≤','üç•','üç£','üç±','üçõ','üçô','üçö','üçò','üçÆ','üéÇ','üç∞','üç¶',
                'üç®','üçß','üç°','üç¢','üç≠','üç¨','üç´','üçø','üç©','üç™'):'–û–æ–æ–æ, –µ–¥–∞–∞–∞!! –≠—Ç–æ —á—Ç–æ–±—ã —è –Ω–µ –ø–æ–¥–æ—Ö–ª–∞ —Å –≥–æ–ª–æ–¥—É, –ø–æ–∫–∞ —Ç—ã –¥—É–º–∞–µ—à—å, –∫–∞–∫ —Ä–∞—Å—Ç–æ–ø–∏—Ç—å –ª—ë–¥ –º–µ–∂–¥—É –Ω–∞–º–∏?',
                ('‚òïÔ∏è','üçµ'):'–¢—ã —Ç–∞–∫–æ–π –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–πüíã –ó–∞—Å—á–∏—Ç–∞—é —ç—Ç–æ—Ç –∂–µ—Å—Ç –∑–∞ –ø–æ–ª–æ–≤–∏–Ω—É –ø–æ–¥–∞—Ä–∫–∞ü§ó'
                }


    for key in good_gift_dic.keys():
        if text in key:
            if text in ANGRY_STAGE_DIC[chat_id]['used_list']:
                bot_answer='–ß—Ç–æ-—Ç–æ –ø–æ—Ö–æ–∂–µ–µ —É–∂–µ –±—ã–ª–æ...–ê —è –≤–æ –≤—Å–µ–º –ª—é–±–ª—é —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ'
            else:
                
                bot_answer=good_gift_dic[key]
                ANGRY_STAGE_DIC[chat_id]['score']+=1
                ANGRY_STAGE_DIC[chat_id]['used_list'].extend(key)
                if ANGRY_STAGE_DIC[chat_id]['know_rules']==True:
                    if ANGRY_STAGE_DIC[chat_id]['score']==4:
                        bot_answer2='–¢—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—å, –±–æ—Ç–æ–≤ —É–∫—Ä–æ—Ç–∏—Ç–µ–ª—å!!!!!'
                    else:
                        bot_answer2='–ï—â–µ {} –∏ –í–∏–∫—Ç–æ—Ä–∏—è –ø–æ—Å—ã–ø–µ—Ç—Å—è'.format(4-ANGRY_STAGE_DIC[chat_id]['score'])
    

    for key in bad_gift_dic.keys():
        if text in key:
            if text in ANGRY_STAGE_DIC[chat_id]['used_list']:
                bot_answer='–ß—Ç–æ-—Ç–æ —Ç–∞–∫–æ–µ —É–∂–µ –±—ã–ª–æ...–ò –Ω–µ—Ç, –Ω–∏ —Å–æ –≤—Ç–æ—Ä–æ–≥–æ, –Ω–∏ —Å —Ç—Ä–µ—Ç—å–µ–≥–æ —Ä–∞–∑–∞ —ç—Ç–æ –Ω–µ –ø—Ä–æ–∫–∞—Ç–∏—Ç))'
            else:
                bot_answer=bad_gift_dic[key]
                ANGRY_STAGE_DIC[chat_id]['used_list'].extend(bad_gift_dic[key])
                ANGRY_STAGE_DIC[chat_id]['used_list'].extend(key)

    if ANGRY_STAGE_DIC[chat_id]['msg_counter']>1 and ANGRY_STAGE_DIC[chat_id]['know_rules']==False:
        custom_keyboard=[['–Ø –Ω–µ –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –º–Ω–µ –¥–µ–ª–∞—Ç—å???']]
        reply_markup = ReplyKeyboardMarkup(custom_keyboard, resize_keyboard=True, one_time_keyboard=False)
    else:
        reply_markup=ReplyKeyboardRemove()


    try:
        if bot_answer=='–í–æ –∏–º—è –ª—É–Ω—ã! –ù–æ –Ω–µ—Ç...—ç—Ç–æ –Ω–µ —Ç–æ...':
            bot.send_document(chat_id, 'https://media.giphy.com/media/26gBjmGEsrFQlj8g8/giphy.gif')
        elif bot_answer=='–¢–≤–æ–∏ –ø–æ–¥–∞—Ä–∫–∏ –¥–µ–ª–∞—é—Ç –º–µ–Ω—è —Å—á–∞—Å—Ç–ª–∏–≤–æ–π! –ê –Ω–∞ –ø—Ä—ã–≥–∞—é—â—É—é –æ—Ç —Å—á–∞—Å—Ç—å—è –∂–µ–Ω—â–∏–Ω—É –º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ...)':
            bot.send_document(chat_id, 'https://media.giphy.com/media/MYwekYh3UIHGE/giphy.gif')
        elif bot_answer=='–ê–∞–∞–∞–∞, —Å —É–º–∞ —Å–æ–π—Ç–∏!!! –°–ø–∞—Å–∏–±–æ —Ç–µ–±–µ!!!!':
            bot.send_document(chat_id, 'https://media.giphy.com/media/3oEhn7OTiXi4mYReyQ/giphy.gif')
        bot.send_message(chat_id=chat_id, text=bot_answer, reply_markup=reply_markup)
        try:
            bot.send_message(chat_id=chat_id, text=bot_answer2)
        except (UnboundLocalError):
            pass

    except (UnboundLocalError):
        if text=='–Ø –Ω–µ –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –º–Ω–µ –¥–µ–ª–∞—Ç—å???':
            ANGRY_STAGE_DIC[chat_id]['know_rules']=True
            reply_markup=ReplyKeyboardRemove()
            bot_answer='–ú—É–∂—á–∏–Ω—ã...'
            bot.send_message(chat_id=chat_id, text=bot_answer, reply_markup=reply_markup)
            bot_answer='–¢—ã –≥–ª—É–±–æ–∫–æ —Ä–∞–Ω–∏–ª –º–µ–Ω—è —Å–≤–æ–µ–π —Ö–æ–ª–æ–¥–Ω–æ—Å—Ç—å—é –∏ —Ä–∞–≤–Ω–¥—É—à–∏–µ–º...–ù–µ –∑–Ω–∞—é, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–∞—Ä–∫–∏, —à—Ç—É–∫–∏ 4, –ø–æ–º–æ–≥–ª–∏ –±—ã –∑–∞—Ç—è–Ω—É—Ç—å—Å—è –º–æ–µ–π —Ä–∞–Ω–µ –±—ã—Å—Ç—Ä–µ–µ?'
            bot.send_message(chat_id=chat_id, text=bot_answer)
            bot_answer='–£–≤–µ—Ä–µ–Ω–∞, –≤ –º–µ—Å—Ç–Ω–æ–º –Ω–∞–±–æ—Ä–µ —ç–º–æ–¥–∑–∏ –Ω–∞–π–¥–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æüòâ –¢–æ–ª—å–∫–æ –¥–∞–≤–∞–π –Ω–µ –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ - —è –ª—é–±–ª—é —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ'
            bot.send_message(chat_id=chat_id, text=bot_answer)
        else:
            lol_answer_list=['–¢—ã –≤–æ–æ–±—â–µ —É–º–µ–µ—à—å —É–≥–æ–∂–¥–∞—Ç—å?','–ê –≤–µ–¥—å –≤–∑—Ä–æ—Å–ª—ã–π, —É–º–Ω—ã–π –º—É–∂—á–∏–Ω–∞...—ç—Ö...','ü§¶‚Äç‚ôÄÔ∏è']    
            bot_answer=lol_answer_list[random.randint(0,len(lol_answer_list)-1)]  
            bot.send_message(chat_id=chat_id, text=bot_answer, reply_markup=reply_markup)
    
    if ANGRY_STAGE_DIC[chat_id]['score']==4:
        return 'final_stage'
    else:
        return 'angry_stage'
